# 校园卡管理系统架构设计评估与改进

## 一、逻辑视图评估（类设计）

### 1. 当前问题
1. **类职责混乱**  
   - 用户类同时处理身份认证、消费记录等
2. **继承结构不合理**  
   - 管理员/学生采用继承关系导致代码重复
3. **数据保护不足**  
   - 关键字段如密码未封装，直接暴露属性

### 2. 解决方案
1. **采用组合模式重构**  
   - 创建独立的`AuthenticationService`处理登录认证  
   - 用户类仅保留基础属性，通过关联关系使用其他服务  
2. **引入策略模式**  
   - 支付方式（现金/扫码）通过`PaymentStrategy`接口实现  
   - 交易记录使用组合关系而非继承  

---

## 二、进程视图问题与改进

### 1. 当前问题
1. **进程通信不安全**  
   - 共享内存未加锁，日志服务丢包  

### 2. 解决方案
1. **通信机制优化**  
   - 进程间通信改用`gRPC`协议  
2. **熔断机制**  
   - 数据库访问添加重试策略（指数退避）  

---

## 三、开发视图问题与改进

### 1. 当前问题
1. **模块边界模糊**  
   - 数据库操作分散在20+个类  
2. **构建效率低下**  
   - 全量编译耗时过长  
3. **版本管理混乱**  
   - 数据库脚本与代码不同步  

### 2. 解决方案
1. **分层重构**  
   - 数据访问层（统一SQL操作）  
   - 接口层（REST/Qt界面）  
2. **构建优化**  
   - 核心模块拆分为动态库  
   - 实现增量编译（CMake配置）  
3. **版本控制**  
   - 数据库迁移纳入Git管理  
   - 使用`Flyway`维护脚本版本  

---

## 四、物理视图问题与改进

### 1. 当前问题
1. **单点故障**  
   - 数据库无备份  
2. **扩展困难**  
   - 硬件不支持水平扩展  

### 2. 解决方案
1. **高可用部署**  
   - 数据库主从复制（MySQL Group Replication）  
2. **容器化准备**  
   - 制作Docker镜像  
   - 编写Kubernetes部署描述文件  
